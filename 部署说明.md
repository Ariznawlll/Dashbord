# æµ‹è¯•ç›‘æ§çœ‹æ¿ - éƒ¨ç½²è¯´æ˜

## ğŸ“¦ éƒ¨ç½²æ–¹å¼æ€»ç»“

æœ¬é¡¹ç›®æä¾›äº†ä¸‰ç§éƒ¨ç½²æ–¹å¼ï¼Œæ¨èä½¿ç”¨ Docker éƒ¨ç½²ï¼š

| æ–¹å¼ | é€‚ç”¨åœºæ™¯ | éš¾åº¦ | æ¨èåº¦ |
|------|---------|------|--------|
| ä¸€é”®è„šæœ¬éƒ¨ç½² | ç”Ÿäº§ç¯å¢ƒ | â­ | â­â­â­â­â­ |
| Docker Compose | ç”Ÿäº§/æµ‹è¯•ç¯å¢ƒ | â­â­ | â­â­â­â­ |
| æ‰‹åŠ¨éƒ¨ç½² | å¼€å‘ç¯å¢ƒ | â­â­â­ | â­â­ |

---

## ğŸš€ æ–¹å¼ä¸€ï¼šä¸€é”®è„šæœ¬éƒ¨ç½²ï¼ˆæœ€ç®€å•ï¼‰

### æ­¥éª¤ 1: é…ç½®ç¯å¢ƒå˜é‡

```bash
cd dashboard/backend
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¿…é¡»é…ç½®ï¼š
- `GITHUB_TOKEN`: ä½ çš„ GitHub Token
- `GITHUB_REPO`: matrixorigin/matrixone

### æ­¥éª¤ 2: ä¸€é”®éƒ¨ç½²

```bash
cd ..
./deploy.sh start
```

### æ­¥éª¤ 3: è®¿é—®æœåŠ¡

- å‰ç«¯: http://æœåŠ¡å™¨IP:3000
- åç«¯: http://æœåŠ¡å™¨IP:3001

### å¸¸ç”¨å‘½ä»¤

```bash
./deploy.sh start    # å¯åŠ¨æœåŠ¡
./deploy.sh stop     # åœæ­¢æœåŠ¡
./deploy.sh restart  # é‡å¯æœåŠ¡
./deploy.sh logs     # æŸ¥çœ‹æ—¥å¿—
./deploy.sh status   # æŸ¥çœ‹çŠ¶æ€
./deploy.sh update   # æ›´æ–°éƒ¨ç½²
```

---

## ğŸ³ æ–¹å¼äºŒï¼šDocker Compose éƒ¨ç½²

### å¼€å‘ç¯å¢ƒéƒ¨ç½²

```bash
# 1. é…ç½®ç¯å¢ƒå˜é‡
cd dashboard/backend
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶

# 2. å¯åŠ¨æœåŠ¡
cd ..
docker-compose up -d

# 3. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# 4. åœæ­¢æœåŠ¡
docker-compose down
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

```bash
# ä½¿ç”¨ç”Ÿäº§é…ç½®æ–‡ä»¶
docker-compose -f docker-compose.prod.yml up -d

# æŸ¥çœ‹çŠ¶æ€
docker-compose -f docker-compose.prod.yml ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f
```

---

## ğŸ› ï¸ æ–¹å¼ä¸‰ï¼šæ‰‹åŠ¨éƒ¨ç½²

### åç«¯éƒ¨ç½²

```bash
cd dashboard/backend

# 1. å®‰è£…ä¾èµ–
npm install

# 2. æ„å»º
npm run build

# 3. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env

# 4. å¯åŠ¨ï¼ˆä½¿ç”¨ PM2ï¼‰
npm install -g pm2
pm2 start dist/index.js --name dashboard-backend
pm2 save
pm2 startup
```

### å‰ç«¯éƒ¨ç½²

```bash
cd dashboard/frontend

# 1. å®‰è£…ä¾èµ–
npm install

# 2. æ„å»º
npm run build

# 3. é…ç½® Nginx
# å°† dist ç›®å½•å†…å®¹å¤åˆ¶åˆ° /var/www/dashboard
# é…ç½® Nginx åå‘ä»£ç†ï¼ˆè§ä¸‹æ–¹é…ç½®ï¼‰
```

### Nginx é…ç½®ç¤ºä¾‹

åˆ›å»º `/etc/nginx/sites-available/dashboard`:

```nginx
server {
    listen 80;
    server_name your-domain.com;

    root /var/www/dashboard;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    location /api {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

å¯ç”¨é…ç½®ï¼š
```bash
sudo ln -s /etc/nginx/sites-available/dashboard /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®

ç¼–è¾‘ `backend/.env` æ–‡ä»¶ï¼š

```bash
# æœåŠ¡ç«¯å£
PORT=3001

# GitHub é…ç½®ï¼ˆå¿…éœ€ï¼‰
GITHUB_TOKEN=ghp_your_token_here
GITHUB_REPO=matrixorigin/matrixone

# Loki æ—¥å¿—ç›‘æ§é…ç½®ï¼ˆJSON æ ¼å¼ï¼‰
LOKI_ENDPOINTS=[{"name":"TKEæµ‹è¯•æ—¥å¿—","url":"https://grafana.ci.matrixorigin.cn/..."},{"name":"å•æœºæµ‹è¯•æ—¥å¿—","url":"https://shanghai.idc.matrixorigin.cn:30001/..."}]

# æ€§èƒ½ç›‘æ§é…ç½®ï¼ˆJSON æ ¼å¼ï¼‰
PERFORMANCE_MONITORS=[{"category":"å•æœºæµ‹è¯•æ€§èƒ½","items":[{"name":"SSB 1G","url":"https://..."}]},{"category":"åˆ†å¸ƒå¼æµ‹è¯•æ€§èƒ½","items":[...]}]
```

### è·å– GitHub Token

1. è®¿é—®: https://github.com/settings/tokens/new
2. è®¾ç½®åç§°: "Dashboard API Access"
3. å‹¾é€‰æƒé™: `repo` æˆ– `public_repo`
4. ç”Ÿæˆå¹¶å¤åˆ¶ token
5. ç²˜è´´åˆ° `.env` æ–‡ä»¶çš„ `GITHUB_TOKEN`

---

## ğŸ“Š æœåŠ¡éªŒè¯

### æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# Docker éƒ¨ç½²
docker-compose ps

# æ‰‹åŠ¨éƒ¨ç½²
pm2 list
sudo systemctl status nginx
```

### æµ‹è¯• API

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:3001/health

# æµ‹è¯• GitHub API
curl http://localhost:3001/api/github/issues

# æµ‹è¯•å‰ç«¯
curl http://localhost:3000
```

---

## ğŸ”’ ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

### 1. é…ç½® HTTPS

```bash
# å®‰è£… Certbot
sudo apt install certbot python3-certbot-nginx

# è·å–è¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

### 2. é…ç½®é˜²ç«å¢™

```bash
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable
```

### 3. è®¾ç½®æ—¥å¿—è½®è½¬

åˆ›å»º `/etc/logrotate.d/dashboard`:

```
/var/log/dashboard/*.log {
    daily
    rotate 14
    compress
    delaycompress
    notifempty
    create 0640 www-data www-data
}
```

### 4. ç›‘æ§æœåŠ¡

```bash
# Docker èµ„æºç›‘æ§
docker stats

# PM2 ç›‘æ§
pm2 monit

# ç³»ç»Ÿèµ„æº
htop
```

---

## â“ å¸¸è§é—®é¢˜

### 1. GitHub API é€Ÿç‡é™åˆ¶

**é—®é¢˜**: 403 é”™è¯¯ï¼Œæç¤º "API rate limit exceeded"

**è§£å†³**: 
- é…ç½® `GITHUB_TOKEN` ç¯å¢ƒå˜é‡
- é‡å¯æœåŠ¡: `./deploy.sh restart`

### 2. ç«¯å£è¢«å ç”¨

**é—®é¢˜**: ç«¯å£ 3000 æˆ– 3001 å·²è¢«å ç”¨

**è§£å†³**: 
- ä¿®æ”¹ `docker-compose.yml` ä¸­çš„ç«¯å£æ˜ å°„
- æˆ–åœæ­¢å ç”¨ç«¯å£çš„æœåŠ¡: `sudo lsof -i :3000`

### 3. å‰ç«¯æ— æ³•è¿æ¥åç«¯

**é—®é¢˜**: å‰ç«¯é¡µé¢æ˜¾ç¤ºä½†æ— æ³•åŠ è½½æ•°æ®

**è§£å†³**:
- æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ: `curl http://localhost:3001/health`
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
- æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯

### 4. Docker æ„å»ºå¤±è´¥

**é—®é¢˜**: npm install å¤±è´¥

**è§£å†³**:
- ä½¿ç”¨å›½å†…é•œåƒ: `npm config set registry https://registry.npmmirror.com`
- æ¸…ç†ç¼“å­˜: `docker-compose build --no-cache`

### 5. æœåŠ¡å¯åŠ¨åæ— æ³•è®¿é—®

**é—®é¢˜**: æœåŠ¡å¯åŠ¨ä½†æ— æ³•è®¿é—®

**è§£å†³**:
- æ£€æŸ¥é˜²ç«å¢™: `sudo ufw status`
- æ£€æŸ¥ç«¯å£ç›‘å¬: `sudo netstat -tlnp | grep 3000`
- æŸ¥çœ‹æ—¥å¿—: `./deploy.sh logs`

---

## ğŸ“ ç»´æŠ¤å‘½ä»¤é€ŸæŸ¥

### Docker éƒ¨ç½²

```bash
# å¯åŠ¨
./deploy.sh start

# åœæ­¢
./deploy.sh stop

# é‡å¯
./deploy.sh restart

# æŸ¥çœ‹æ—¥å¿—
./deploy.sh logs

# æŸ¥çœ‹çŠ¶æ€
./deploy.sh status

# æ›´æ–°éƒ¨ç½²
./deploy.sh update

# è¿›å…¥å®¹å™¨
docker-compose exec backend sh
docker-compose exec frontend sh
```

### æ‰‹åŠ¨éƒ¨ç½²

```bash
# PM2 ç®¡ç†
pm2 list
pm2 logs dashboard-backend
pm2 restart dashboard-backend
pm2 stop dashboard-backend

# Nginx ç®¡ç†
sudo nginx -t
sudo systemctl status nginx
sudo systemctl reload nginx
sudo systemctl restart nginx

# æŸ¥çœ‹æ—¥å¿—
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹ [DEPLOYMENT.md](./DEPLOYMENT.md) è¯¦ç»†æ–‡æ¡£
2. æŸ¥çœ‹ [README.md](./README.md) é¡¹ç›®è¯´æ˜
3. è”ç³»é¡¹ç›®ç»´æŠ¤è€…

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰æ£€æŸ¥ï¼š
- [ ] å·²å®‰è£… Docker å’Œ Docker Compose
- [ ] å·²é…ç½® `.env` æ–‡ä»¶
- [ ] å·²è·å– GitHub Token
- [ ] å·²é…ç½®é˜²ç«å¢™è§„åˆ™
- [ ] å·²å‡†å¤‡åŸŸåï¼ˆå¦‚éœ€è¦ï¼‰

éƒ¨ç½²åæ£€æŸ¥ï¼š
- [ ] æœåŠ¡æ­£å¸¸å¯åŠ¨
- [ ] å‰ç«¯é¡µé¢å¯è®¿é—®
- [ ] åç«¯ API æ­£å¸¸å“åº”
- [ ] GitHub æ•°æ®æ­£å¸¸åŠ è½½
- [ ] æ—¥å¿—ç›‘æ§é“¾æ¥æ­£å¸¸
- [ ] æ€§èƒ½ç›‘æ§é“¾æ¥æ­£å¸¸

---

ç¥éƒ¨ç½²é¡ºåˆ©ï¼ğŸ‰
